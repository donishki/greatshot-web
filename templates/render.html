{% extends "layout.html" %}
{% block title %}Render output{% endblock %}

{% macro render_streamable(shortcode) %}
    <a href="https://streamable.com/{{ shortcode }}">https://streamable.com/{{ shortcode }} - HD version* </a>
<div class="wrap" {% if shortcode|length==0 %}style="display:none;"{% endif %}>
    <a href="https://streamable.com/{{ shortcode }}">https://streamable.com/{{ shortcode }}</a>
    <span id="oembed">
    </span>
</div>
<p>*HD doesn't work with embeded video</p>
{% if shortcode|length!=0 %}
<script>
$(function() {
  $.ajax({url: "https://api.streamable.com/oembed.json?url=https://streamable.com/{{ shortcode }}", dataType: "json",
    success: function(json){
        $('#oembed').html(json.html);
    }
  });
});
</script>
{% endif %}
{% endmacro %}

{% block content %}
<h1>{{ render.title }}</h1>
{% if render.streamable_short %}
  {{ render_streamable(render.streamable_short) }}
{% else %}
<script>

function doPoll(){

  $.ajax({url: "/renders/{{ render.id }}", dataType: "json", success: function(task){
        if (task=="PENDING") {
          $('.progress-bar').css({'width': 100 + '%'});
          $('.progress-bar').html("(im playing offi atm have to turn off, sry squid :D ) No renderer available, reload page later");
          setTimeout(doPoll,5000);
        }
        else if (task.stage) {
          $('.progress-bar').css({'width': task.i + '%'});
          $('.progress-bar').html(task.stage);
          setTimeout(doPoll,3000);
         } else {
          $('.progress').hide();
          $('.wrap iframe').attr('src',$('.wrap iframe').attr('src')+task+'?autoplay=1&hd=1');
          $('.wrap a').attr('href',$('.wrap a').attr('href')+task);
          $('.wrap').show();
        }
    }});
}

$(function() {
  doPoll();
});
</script>

<div class="progress">
  <div class="progress-bar progress-bar-striped active" role="progressbar" style="width:0%">
    polling status...
  </div>
</div>
{{ render_streamable("") }}
{% endif %}


{#
  <video controls>
    <source src="/static/render.mp4" type="video/mp4">
  </video>
  <a href="/static/render.mp4">Download render</a>
#}

{% endblock %}

